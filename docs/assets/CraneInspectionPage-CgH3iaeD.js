import{j as e,t as O,X as se,$ as te,H as ae,a6 as re,Z as Q}from"./ui-Donqwxo7.js";import{r as o}from"./vendor-CW-_dNtU.js";import{b as G,u as ne,c as X}from"./query-Cw8NcARV.js";import{C as le,h as _,u as ce}from"./index-CmI2uZiO.js";import{B as H}from"./badge-eiixo76M.js";import{B as m}from"./button-gHr9dfwR.js";import{I as v}from"./input-BvEpzQI5.js";import{a as ie,u as de,b as oe,s as me,C as xe,N as P,S as g,n as ue}from"./use-admin-BLZNP0tc.js";import{z as c,u as he,C as K,t as pe}from"./index-DBEqNSC_.js";import{L as j}from"./label-D7Eeu5EM.js";import{S as je,a as be,b as fe,c as ye,d as U,e as ge}from"./switch-BrUN3v4I.js";import"./utils-BTGVH9Kg.js";const q={submitted:{label:"Submitted",className:"bg-primary/10 text-primary border-primary/20"},draft:{label:"Draft",className:"bg-muted text-muted-foreground border-border"},pending:{label:"Pending",className:"bg-amber-500/10 text-amber-600 border-amber-500/20"}},Z=[{key:"inspector",label:"Inspector"},{key:"buddy",label:"Buddy"},{key:"machine",label:"Machine"},{key:"bay",label:"Bay"},{key:"date",label:"Date"},{key:"status",label:"Status"}],N=10;function Ne({onNew:S}){const x=G(),b=ie(),n=de(),{data:l=[],isLoading:i}=ne({queryKey:["/api/crane-inspections"]}),[t,u]=o.useState(""),[L,w]=o.useState(!1),[B,J]=o.useState(null),[d,W]=o.useState({field:"",dir:null}),[C,Y]=o.useState(!1),[h,I]=o.useState(1),[E,ee]=oe(Z),F=X({mutationFn:s=>_("DELETE",`/api/crane-inspections/${s}`),onSuccess:()=>x.invalidateQueries({queryKey:["/api/crane-inspections"]})}),p=o.useMemo(()=>{if(!t.trim())return l;const s=t.toLowerCase();return l.filter(a=>{var y,R,T,z,$,V;return((y=a.inspector)==null?void 0:y.toLowerCase().includes(s))||((R=a.buddyInspector)==null?void 0:R.toLowerCase().includes(s))||((T=a.machine)==null?void 0:T.toLowerCase().includes(s))||((z=a.bay)==null?void 0:z.toLowerCase().includes(s))||(($=a.date)==null?void 0:$.toLowerCase().includes(s))||((V=a.status)==null?void 0:V.toLowerCase().includes(s))})},[l,t]),k=o.useMemo(()=>me(p,d.field,d.dir),[p,d]),f=s=>W(a=>ue(a.field,a.dir,s)),M=Math.ceil(k.length/N),A=C?k:k.slice((h-1)*N,h*N),D=s=>{u(s),I(1)},r=s=>E[s]!==!1;return e.jsxs(le,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4 p-5 border-b border-border",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"Crane Inspections"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Pre-use inspection records · ",l.length," record",l.length!==1?"s":""]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[L?e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(v,{placeholder:"Search inspections...",value:t,onChange:s=>D(s.target.value),className:"pl-9 w-[220px]",autoFocus:!0}),e.jsx("button",{type:"button",onClick:()=>{w(!1),D("")},className:"absolute right-2 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:e.jsx(se,{className:"h-4 w-4"})})]}):e.jsx(m,{variant:"outline",size:"icon",onClick:()=>w(!0),children:e.jsx(O,{className:"h-4 w-4"})}),b&&e.jsx(xe,{columns:Z,visible:E,onChange:ee}),e.jsxs(m,{onClick:S,className:"gap-2",children:[e.jsx(te,{className:"h-4 w-4"})," New Inspection"]})]})]}),i?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"h-8 w-8 mx-auto mb-3 rounded-full border-2 border-primary border-t-transparent animate-spin"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading inspections..."})]}):p.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-12 h-12 mx-auto mb-4 rounded-full bg-muted flex items-center justify-center",children:e.jsx(ae,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"font-medium",children:t?"No matching inspections":"No inspections yet"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:t?"Try adjusting your search terms":"Create one to get started"})]}):e.jsxs(e.Fragment,{children:[n&&e.jsx("div",{className:"divide-y divide-border",children:A.map(s=>{const a=q[s.status]||q.draft,y=B===s.id;return e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("button",{type:"button",className:"flex items-center justify-between w-full text-left",onClick:()=>J(y?null:s.id),children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:s.machine}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.inspector})]}),e.jsx(re,{className:`h-4 w-4 text-muted-foreground transition-transform ${y?"rotate-180":""}`})]}),y&&e.jsxs("div",{className:"mt-3 space-y-2 pl-1",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground w-20",children:"Buddy"}),e.jsx(P,{name:s.buddyInspector})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground w-20",children:"Bay"}),e.jsx("span",{children:s.bay})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground w-20",children:"Date"}),e.jsx("span",{children:s.date})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-muted-foreground w-20",children:"Status"}),e.jsx(H,{variant:"outline",className:a.className,children:a.label})]}),e.jsx("div",{className:"pt-1",children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive",onClick:()=>F.mutate(s.id),children:e.jsx(Q,{className:"h-3.5 w-3.5"})})})]})]},s.id)})}),!n&&e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border bg-muted/50",children:[r("inspector")&&e.jsx(g,{label:"Inspector",field:"inspector",current:d,onSort:f}),r("buddy")&&e.jsx(g,{label:"Buddy",field:"buddyInspector",current:d,onSort:f}),r("machine")&&e.jsx(g,{label:"Machine",field:"machine",current:d,onSort:f}),r("bay")&&e.jsx(g,{label:"Bay",field:"bay",current:d,onSort:f}),r("date")&&e.jsx(g,{label:"Date",field:"date",current:d,onSort:f}),r("status")&&e.jsx(g,{label:"Status",field:"status",current:d,onSort:f}),e.jsx("th",{className:"py-3 px-5"})]})}),e.jsx("tbody",{children:A.map(s=>{const a=q[s.status]||q.draft;return e.jsxs("tr",{className:"border-b border-border last:border-0 hover:bg-primary/5 transition-colors",children:[r("inspector")&&e.jsx("td",{className:"py-3.5 px-5",children:e.jsx(P,{name:s.inspector})}),r("buddy")&&e.jsx("td",{className:"py-3.5 px-5",children:e.jsx(P,{name:s.buddyInspector})}),r("machine")&&e.jsx("td",{className:"py-3.5 px-5 text-sm",children:s.machine}),r("bay")&&e.jsx("td",{className:"py-3.5 px-5 text-sm text-muted-foreground",children:s.bay}),r("date")&&e.jsx("td",{className:"py-3.5 px-5 text-sm text-muted-foreground",children:s.date}),r("status")&&e.jsx("td",{className:"py-3.5 px-5",children:e.jsx(H,{variant:"outline",className:a.className,children:a.label})}),e.jsx("td",{className:"py-3.5 px-5",children:e.jsx(m,{variant:"ghost",size:"icon",className:"h-7 w-7 text-muted-foreground hover:text-destructive",onClick:()=>F.mutate(s.id),children:e.jsx(Q,{className:"h-3.5 w-3.5"})})})]},s.id)})})]})})]}),!i&&p.length>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 px-5 py-3 border-t border-border bg-muted/30 text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Showing ",C?p.length:`${(h-1)*N+1}–${Math.min(h*N,k.length)}`," of ",p.length," inspection",p.length!==1?"s":"",t&&` matching "${t}"`]}),e.jsxs("div",{className:"flex items-center gap-2",children:[!C&&M>1&&e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",disabled:h<=1,onClick:()=>I(s=>s-1),children:"Prev"}),e.jsxs("span",{className:"text-xs tabular-nums",children:[h," / ",M]}),e.jsx(m,{variant:"outline",size:"sm",className:"h-7 text-xs px-2",disabled:h>=M,onClick:()=>I(s=>s+1),children:"Next"})]}),e.jsx(m,{variant:"ghost",size:"sm",className:"h-7 text-xs",onClick:()=>{Y(!C),I(1)},children:C?`Show ${N} per page`:"Show all"})]})]})]})}const ve=c.object({inspector:c.string().min(1,"Required"),buddyInspector:c.string().min(1,"Required"),bay:c.string().min(1,"Required"),machine:c.string().min(1,"Required"),date:c.string().min(1,"Required"),q1:c.enum(["yes","no"]),q2:c.enum(["yes","no"]),q3:c.enum(["yes","no"]),status:c.enum(["draft","submitted"])}),Se=[{key:"q1",label:"Pre-use inspection checklist completed"},{key:"q2",label:"All safety devices operational"},{key:"q3",label:"Load chart visible and within limits"}];function we({onSubmit:S,onCancel:x,isLoading:b}){const{register:n,handleSubmit:l,control:i,formState:{errors:t}}=he({resolver:pe(ve),defaultValues:{inspector:"",buddyInspector:"",bay:"",machine:"",date:"",q1:"no",q2:"no",q3:"no",status:"draft"}});return e.jsxs("form",{onSubmit:l(S),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Inspector"}),e.jsx(v,{...n("inspector"),placeholder:"Name"}),t.inspector&&e.jsx("p",{className:"text-xs text-destructive",children:t.inspector.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Buddy Inspector"}),e.jsx(v,{...n("buddyInspector"),placeholder:"Name"}),t.buddyInspector&&e.jsx("p",{className:"text-xs text-destructive",children:t.buddyInspector.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Bay"}),e.jsx(v,{...n("bay"),placeholder:"e.g. Bay 3"}),t.bay&&e.jsx("p",{className:"text-xs text-destructive",children:t.bay.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Machine"}),e.jsx(v,{...n("machine"),placeholder:"e.g. Crane A"}),t.machine&&e.jsx("p",{className:"text-xs text-destructive",children:t.machine.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Date"}),e.jsx(v,{type:"date",...n("date")}),t.date&&e.jsx("p",{className:"text-xs text-destructive",children:t.date.message})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(j,{children:"Status"}),e.jsx(K,{name:"status",control:i,render:({field:u})=>e.jsxs(je,{value:u.value,onValueChange:u.onChange,children:[e.jsx(be,{children:e.jsx(fe,{})}),e.jsxs(ye,{children:[e.jsx(U,{value:"draft",children:"Draft"}),e.jsx(U,{value:"submitted",children:"Submitted"})]})]})})]})]}),e.jsxs("div",{className:"space-y-3 pt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Inspection Checklist"}),Se.map(({key:u,label:L})=>e.jsx(K,{name:u,control:i,render:({field:w})=>e.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-border last:border-0",children:[e.jsx(j,{className:"text-sm font-normal cursor-pointer",children:L}),e.jsx(ge,{checked:w.value==="yes",onCheckedChange:B=>w.onChange(B?"yes":"no")})]})},u))]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-2",children:[e.jsx(m,{type:"button",variant:"outline",onClick:x,children:"Cancel"}),e.jsx(m,{type:"submit",disabled:b,children:b?"Saving...":"Save Inspection"})]})]})}function Re(){const[S,x]=o.useState(!1),b=G(),{toast:n}=ce(),l=X({mutationFn:i=>_("POST","/api/crane-inspections",i),onSuccess:()=>{b.invalidateQueries({queryKey:["/api/crane-inspections"]}),x(!1),n({title:"Inspection saved."})}});return e.jsx("div",{className:"p-4 sm:p-6",children:S?e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"New Crane Inspection"}),e.jsx(we,{onSubmit:i=>l.mutate(i),onCancel:()=>x(!1),isLoading:l.isPending})]}):e.jsx(Ne,{onNew:()=>x(!0)})})}export{Re as default};
